#!/bin/sh
set -e

VELOCITY_DIR="$HOME/src/cc/velocity"

docker_compose() {
  cd "$VELOCITY_DIR"
  exec docker-compose "$@"
}

docker_compose_noexec() {
  cd "$VELOCITY_DIR"
  docker-compose "$@"
}

case "$1" in
  restart)
    docker_compose_noexec stop "$2"
    docker_compose_noexec rm -f "$2"
    docker_compose_noexec up -d "$2"
  ;;
  rake)
    shift
    docker_compose run web rake "$@"
  ;;
  rails)
    shift
    docker_compose run web rails "$@"
  ;;
  psql)
    docker_compose run postgres psql \
      --host=postgres \
      --port=5432 \
      --username=postgres \
      --dbname=velocity_development
  ;;
  *) docker_compose "$@";;
esac
